# SwitchBot Go アプリケーション

## 概要

このアプリケーションは、Go言語とFyne GUIツールキットで構築されたデスクトップアプリケーションで、SwitchBotデバイスを制御するために設計されています。ユーザーはSwitchBotのAPIキーを設定し、スマート電球、ボット、カーテン、プラグ、IRデバイスなどのデバイスを追加・管理し、コンピューターから直接それらを制御できます。このアプリケーションは、スマートホームデバイスを管理するためのユーザーフレンドリーなインターフェースを提供することを目指しています。

## 機能

- **APIキー設定:** 安全な通信のためにSwitchBotのAPIキーとクライアントシークレットを設定します。
- **デバイス管理:** 様々なSwitchBotデバイスを追加、表示、削除します。
- **デバイス制御:**
  - **スマート電球:** オン/オフ、明るさ調整、色設定、色温度設定。
  - **ボット:** 押す、オン/オフ。
  - **カーテン:** 開閉、位置設定、一時停止。
  - **プラグ:** オン/オフ。
  - **加湿器:** モード設定（自動、カスタム効率）。
  - **サーキュレーター:** オン/オフ、ファン速度設定。
  - **ロック:** ロック/アンロック。
  - **ロボット掃除機:** 開始/停止、ドックに戻る、吸引レベル設定。
  - **IRデバイス:** 特化されていないIRデバイスの汎用コマンド送信、およびIRエアコンとテレビの特定の制御。
- **設定の永続化:** デバイスとAPIキーの設定は `device_data.json` に保存されます。
- **自動更新:** 特定のデバイスのパネルは、定期的にステータスを自動更新します。
- **アプリ内ログ:** アプリケーションのログをUI内で直接表示します。

## はじめに

### 前提条件

- Go (バージョン1.18以上を推奨)
- Fyneの依存関係 (`go mod tidy` によって自動的に処理されます)

### ビルド

実行可能ファイルをビルドするには、ターミナルでプロジェクトのルートディレクトリに移動し、以下を実行します。

```bash
# Windows用 (コンソールウィンドウを非表示にする)
go build -ldflags="-H windowsgui" -o switchbot-go.exe

# Linux/macOS用
go build -o switchbot-go
```

これにより、プロジェクトのルートディレクトリに `switchbot-go.exe` (Linux/macOSでは `switchbot-go`) という名前の実行可能ファイルが作成されます。

### ソースコード構造

プロジェクトは以下のトップレベルディレクトリで構成されています。

-   `config/`: アプリケーション設定とデバイスデータの読み込みおよび保存を含む、設定管理ロジックが含まれています。
-   `switchbot/`: SwitchBot APIクライアントを実装し、認証とSwitchBotクラウドサービスとの通信を処理します。
-   `ui/`: ダイアログ、個々のデバイスタイプ用のパネル、カスタムウィジェットなど、すべてのFyne GUI関連のコードが格納されています。


### 実行

ビルドされたアプリケーションを実行します。

-   **Windows:** ファイルエクスプローラーで `switchbot-go.exe` をダブルクリックするか、コマンドラインから実行します。
    ```bash
    switchbot-go.exe
    ```
-   **Linux/macOS:** ターミナルから実行します。
    ```bash
    ./switchbot-go
    ```


## 使用方法

1.  **APIキーの設定:** 初回起動時、またはツールバーの「設定」オプションから、SwitchBotのAPIキーとクライアントシークレットを入力します。
2.  **デバイスの追加:** ツールバーの「デバイス追加」をクリックします。デバイスIDと名前を手動で入力するか、「APIからデバイスリストを取得」を使用してデバイスをフェッチして選択できます。
3.  **デバイスの制御:** 追加されたデバイスはパネルとして表示されます。各パネルの「操作」ボタンを使用して、特定の制御ダイアログを開きます。
4.  **デバイスの管理:** デバイスパネルの「編集」および「X」（削除）ボタンを使用して、デバイスを変更または削除します。

## API統合

このアプリケーションはSwitchBot API v1.1と連携します。認証はAPIトークン、クライアントシークレット、およびHMAC-SHA256署名を使用して処理されます。

## GUIフレームワーク

Fyne (https://fyne.io/) がクロスプラットフォームGUIツールキットとして使用されており、単一の実行可能バイナリの作成を可能にしています。

## 設定

デバイスとAPIキーの設定は、実行可能ファイルと同じディレクトリにある `device_data.json` に自動的に保存されます。

## 今後の機能強化

- シーン制御機能の実装（シーンのリスト表示と実行）。
- 汎用IRデバイス制御のさらなる改善（より多くの事前定義された共通コマンドの追加）。
